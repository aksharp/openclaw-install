# ---------------------------------------------------------------------------
# OpenClaw Helm chart — prerequisites / values override
# Copy to prerequisites.yaml, fill in your values, then run:
#   helm upgrade --install openclaw ./openclaw -f prerequisites.yaml -n openclaw --create-namespace
# Do NOT put secrets in this file; use Kubernetes Secrets or Vault.
# ---------------------------------------------------------------------------

# ---- OpenClaw version (upgradeable: set to desired stable release) ----
openclaw:
  image:
    repository: ghcr.io/openclaw/openclaw
    tag: "v1.0.0"   # e.g. v1.2.3 — see https://github.com/openclaw/openclaw/releases
    pullPolicy: IfNotPresent

# ---- Identity (optional overrides) ----
nameOverride: ""
fullnameOverride: ""
namespaceOverride: ""

# ---- Tailscale (V10): hostname of this node in your tailnet ----
tailscale:
  enabled: true
  hostname: "openclaw"   # From tailscale status or admin console
  funnel: false          # Do not use Funnel for gateway

# ---- Vault (required; chart deploys and bootstraps it) ----
vault:
  existingSecret: "openclaw-vault-gateway-token"
  secretKey: token

# ---- Gateway (non-secret config) ----
gateway:
  port: 18789
  bind: "loopback"
  tokenSecretName: "openclaw-gateway-token"
  tokenSecretKey: "token"
  discovery:
    mdns: "off"
  signal:
    accountKeyInVault: "openclaw/signal"   # Vault path for Signal credentials
  moltbook:
    enabled: false   # Set true if using Moltbook; add credentials in Vault
  resources:
    limits:
      memory: 4G
      cpu: "4"
    requests:
      memory: 512Mi
      cpu: "100m"
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    runAsGroup: 1000
  tmpfsSize: "64Mi"
  extraMounts: []

# ---- Observability (V10: OTel Collector + Prometheus + Grafana + Loki + Alertmanager) ----
observability:
  enabled: true
  # OTLP: in-cluster URL is set automatically; set otlpEndpointTailscale when observability is on another host
  otlpEndpointTailscale: ""   # e.g. "http://observability:4318"
  otelCollector:
    enabled: true
  prometheus:
    enabled: true
  grafana:
    enabled: true
    existingSecret: ""       # e.g. openclaw-grafana-admin (create secret with admin-password key)
    secretKey: admin-password
  loki:
    enabled: true
  alertmanager:
    enabled: true
    # config: {}              # Override for Slack/PagerDuty etc.; else route to 'null'
  mimir:
    enabled: false            # Optional long-term Prometheus storage

# ---- Ingress (required: all access is via Ingress hostnames) ----
# HAProxy + cert-manager are always installed with the openclaw chart. Set ingress.domain (default openclaw.local).
# Add /etc/hosts or DNS so openclaw.{domain}, vault.{domain}, etc. resolve to the Ingress. Per V10: restrict access (Tailscale/private).
ingress:
  className: haproxy
  domain: "openclaw.local"   # override for production (e.g. your-domain.com)
  tls:
    enabled: false
    secretName: ""
  hosts:
    gateway: true
    gatewayHost: ""
    vault: true
    vaultHost: ""
    grafana: true
    grafanaHost: ""
    prometheus: true
    prometheusHost: ""

# ---- Sandbox image (optional) ----
sandbox:
  image:
    repository: openclaw-sandbox
    tag: bookworm-slim
